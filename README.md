# xv6-thread

이 프로젝트는 MIT의 교육용 운영체제인 xv6를 기반으로 멀티스레드 기능을 추가 구현한 것입니다. 운영체제 내부의 프로세스와 스레드 관리, 동기화 등의 핵심 개념을 이해하고 직접 구현해봄으로써, 시스템 프로그래밍과 운영체제에 대한 깊이 있는 지식을 쌓는 것을 목표로 합니다.

## 원 프로젝트 정보

이 프로젝트는 [MIT xv6](https://pdos.csail.mit.edu/6.828/2022/xv6.html) 운영체제를 기반으로 합니다. xv6는 Unix v6를 x86 아키텍처에 맞게 재구현한 교육용 운영체제입니다. 

xv6의 소스 코드는 Frans Kaashoek, Robert Morris, Russ Cox가 저작권을 갖고 있습니다. 자세한 내용은 [GitHub 저장소](https://github.com/mit-pdos/xv6-riscv)를 참조하세요.

## 프로젝트 개요
이 프로젝트는 xv6 운영체제에 다음과 같은 기능을 추가 구현하였습니다:

1. **clone과 join 시스템 콜**: 새로운 스레드를 생성하고 종료를 기다리는 기본적인 스레드 관리 기능을 제공합니다.
2. **thread_create와 thread_join API**: 사용자 레벨에서 쉽게 스레드를 생성하고 관리할 수 있는 고수준 API를 제공합니다.
3. **mutex_lock과 mutex_unlock 시스템 콜**: 스레드 간 동기화를 위한 뮤텍스 락을 구현하여, 경쟁 상태를 방지합니다.

이를 통해 xv6 운영체제에서 멀티스레딩을 지원하고, 스레드 간의 동기화 문제를 해결할 수 있게 되었습니다.


## 추가 구현 사항

### clone, join 시스템 콜

clone 시스템 콜은 새로운 스레드를 생성하는 기능을 제공합니다. 이 시스템 콜은 스레드의 스택 공간을 인자로 받아, 현재 프로세스의 주소 공간을 공유하는 새로운 스레드를 생성합니다. 새로 생성된 스레드는 부모 스레드와 동일한 프로세스에 속하지만, 독립적인 스택을 가지고 실행됩니다.

join 시스템 콜은 특정 스레드의 종료를 기다리는 기능을 제공합니다. 이 시스템 콜은 대상 스레드가 종료될 때까지 호출자 스레드를 블록시키고, 대상 스레드가 종료되면 그 스레드의 리소스를 정리하고 종료 상태를 반환합니다.

이 두 시스템 콜의 구현을 통해, 프로세스 내에서 멀티스레딩을 지원하고, 스레드의 생성과 종료를 관리할 수 있게 되었습니다.

### thread_create, thread_join API

thread_create와 thread_join 함수는 사용자 레벨에서 스레드를 쉽게 생성하고 관리할 수 있는 고수준 API를 제공합니다.

thread_create 함수는 새로운 스레드를 생성하는 기능을 제공합니다. 이 함수는 새로운 스레드가 실행할 함수와 그 함수의 인자를 받아, 내부적으로 clone 시스템 콜을 호출하여 새로운 스레드를 생성합니다. 또한, 스레드의 스택 공간을 동적으로 할당하고 관리하는 기능도 포함되어 있습니다.

thread_join 함수는 특정 스레드의 종료를 기다리는 기능을 제공합니다. 이 함수는 대상 스레드의 ID를 인자로 받아, 내부적으로 join 시스템 콜을 호출하여 대상 스레드의 종료를 기다립니다. 대상 스레드가 종료되면, 이 함수는 스레드의 종료 상태를 반환합니다.

이 두 함수의 구현을 통해, 사용자 프로그램에서 운영체제가 제공하는 저수준 스레드 관리 기능을 직접 사용하지 않고도 쉽게 멀티스레딩을 활용할 수 있게 되었습니다.

### mutex_lock, mutex_unlock 시스템 콜

mutex_lock과 mutex_unlock 시스템 콜은 스레드 간 동기화를 위한 뮤텍스 락 기능을 제공합니다. 뮤텍스 락은 여러 스레드가 공유 자원에 배타적으로 접근할 수 있도록 보장하여, 경쟁 상태를 방지합니다.

mutex_lock 시스템 콜은 뮤텍스 락을 획득하는 기능을 제공합니다. 이 시스템 콜은 뮤텍스 락을 나타내는 정수형 변수의 포인터를 인자로 받습니다. 호출한 스레드는 해당 뮤텍스 락을 획득하려 시도하고, 이미 다른 스레드가 그 락을 획득한 상태라면 락이 해제될 때까지 대기합니다.

mutex_unlock 시스템 콜은 뮤텍스 락을 해제하는 기능을 제공합니다. 이 시스템 콜은 mutex_lock으로 획득한 뮤텍스 락을 해제하여, 다른 대기 중인 스레드가 그 락을 획득할 수 있도록 합니다.

이 두 시스템 콜의 구현을 통해, 스레드 간 동기화를 안전하게 수행할 수 있게 되었습니다. 이는 멀티스레딩 환경에서 공유 자원을 보호하고, 데이터 불일치 문제를 방지하는 데 핵심적인 역할을 합니다.

### 프로젝트의 의의
이 프로젝트는 운영체제의 핵심 개념인 프로세스, 스레드, 동기화 등을 깊이 있게 이해하고, 실제로 구현해보는 경험을 제공합니다. 이를 통해 얻은 지식과 경험은 시스템 프로그래밍과 운영체제 분야에서 매우 중요한 자산이 될 것입니다.

특히, 이 프로젝트에서 구현한 멀티스레딩과 동기화 기능은 현대적인 서버 프로그래밍에서 필수적인 요소입니다. 이러한 개념을 운영체제 수준에서 직접 다뤄본 경험은, 고성능 서버 애플리케이션을 개발하는 데 있어 큰 도움이 될 것입니다.
